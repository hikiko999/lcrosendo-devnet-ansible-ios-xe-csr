---
# tasks file for basic-config
- name: CREATE OUTPUT OLD CONFIG FOLDER
  file:
    path: "../outputs/{{ inventory_hostname }}/old/"
    state: directory
    mode: 0775
  run_once: true
- name: CREATE OUTPUT NEW CONFIG FOLDER
  file:
    path: "../outputs/{{ inventory_hostname }}/new/"
    state: directory
    mode: 0775
  run_once: true
- name: CREATE CONFIGURATION OUTPUT PATHS
  set_fact:
    old_config_path: "../outputs/{{ inventory_hostname }}/old/{{ now() }}_{{ inventory_hostname }}"
    new_config_path: "../outputs/{{ inventory_hostname }}/new/{{ now() }}_{{ inventory_hostname }}"

- name: GATHER OLD CONFIG
  cisco.ios.ios_facts:
    gather_subset: 
      - all
  register: old_config

- name: SHOW OLD CONFIG
  debug:
    msg: "{{ old_config }}"

- name: SAVE OLD CONFIG
  copy:
    content: "{{ old_config }}"
    dest: "{{ old_config_path }}"
    mode: 0664

- name: SHOW PRE CONFIG
  debug:
    msg: "{{ lookup('template', 'templates/config_pre.j2') }}"

# PROMPT HERE FOR CHANGE

- name: CHANGE HOSTNAME
  include_tasks:
    file: change_hostname.yml
  with_dict: "{{ configuration }}"
  when: item['dev_hostname'] is defined

- name: CHANGE INTERFACE
  include_tasks:
    file: change_interface.yml
  with_dict: "{{ configuration }}"
  when: item['dev_interfaces'] is defined

- name: GATHER NEW CONFIG
  cisco.ios.ios_facts:
    gather_subset: 
      - all
  register: new_config

- name: SAVE NEW CONFIG
  copy:
    content: "{{ new_config }}"
    dest: "{{ new_config_path }}"
    mode: 0664

- name: SHOW NEW CONFIG
  debug:
    msg: "{{ lookup('template', 'templates/config_post.j2') }}"